<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ˜Ÿéš›é‡é›£è€…ï¼šå¤œå¸‚æ±‚ç”Ÿæˆ°</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- 1. éŠæˆ²è¨­å®šè³‡æ–™ (Configuration) ---
        const ROLES = {
            1: "æ¼¢å¾·æ£®", 2: "è³ˆæ–¯å¹½", 3: "æ ¼æ‹‰å…‹", 4: "æˆˆå¾·å‡",
            5: "æ€ç‘ªç‰¹", 6: "å‰å°¼äº", 7: "è‰¾è‰æ ¹", 8: "æ‹‰å¼—ç±³",
            9: "ç®¡ç†å“¡"
        };

        const FOOD_DATA = {
            101: { name: "è±ªå¤§å¤§é›æ’", score: 80, desc: "å·¨å¤§çš„æ‰å¹³ç”Ÿç‰©çµ„ç¹”ï¼Œè˜Šå«æ¥µé«˜æ²¹è„‚å‹•èƒ½ã€‚" },
            102: { name: "å¤§è…¸åŒ…å°è…¸", score: 50, desc: "è…¸é“åŒ…è£¹è‘—ç¢³æ°´åŒ–åˆç‰©ï¼Œçµæ§‹ç²¾å·§çš„èƒ½é‡æ£’ã€‚" },
            103: { name: "çç å¥¶èŒ¶", score: 80, desc: "å¯Œå«é«˜å¯†åº¦æ¾±ç²‰çƒé«”ï¼Œæ¶²æ…‹ç³–åˆ†æ¥µæ˜“å¸æ”¶ã€‚" },
            104: { name: "èšµä»”ç…", score: 50, desc: "æµ·æ´‹è»Ÿé«”å‹•ç‰©èˆ‡æ¾±ç²‰çš„æ··åˆé»æ¶²ï¼Œå£æ„Ÿç¥ç¥•ã€‚" },
            105: { name: "èŠ’æœé›ªèŠ±å†°", score: 80, desc: "ä½æº«çµæ™¶é«”ä½ä»¥é»ƒè‰²æœå¯¦ï¼Œèƒ½å†·å»åæ‡‰çˆã€‚" },
            106: { name: "æ·±å‘è‡­è±†è…", score: 50, desc: "æ•£ç™¼å¼·çƒˆç”ŸåŒ–æ°£å‘³ï¼Œç–‘ä¼¼é«˜æ¿ƒåº¦ç¡«åŒ–ç‡ƒæ–™ã€‚" },
            107: { name: "è—¥ç‡‰æ’éª¨", score: 80, desc: "é»‘è‰²æ¶²é«”ä¸­æµ¸æ³¡è‘—è„Šæ¤éª¨ï¼Œå……æ»¿æœªçŸ¥çš„è‰æœ¬èƒ½é‡ã€‚" },
            108: { name: "åœ°ç“œçƒ", score: 50, desc: "ä¸­ç©ºçš„æ²¹ç‚¸çƒé«”ï¼Œé›–ç„¶ç©ºæ°£å¾ˆå¤šä½†å¤–æ®¼é…¥è„†ã€‚" },
            201: { name: "ç³–è‘«è˜†", score: 10, desc: "ç´…è‰²çƒé«”è¢«ç¡¬åŒ–ç³–è¡£åŒ…è£¹ï¼Œèƒ½é‡å¯†åº¦æ¥µä½ã€‚" },
            202: { name: "ç«ç„°ç‚™ç‡’ç‰›æ’", score: 110, desc: "é«˜æº«è™•ç†çš„è›‹ç™½è³ªå¡Šï¼Œå¯Œå«ç´…è¡€ç´ èˆ‡ç†±èƒ½ã€‚" },
            203: { name: "è±¬è¡€ç³•", score: 10, desc: "é»‘è‰²æ–¹å¡Šæ··åˆäº†ç”Ÿç‰©æ¶²é«”èˆ‡ç©€ç‰©ï¼Œèƒ½é‡åæ‡‰å¾®å¼±ã€‚" },
            204: { name: "æ½¤é¤…æ²", score: 60, desc: "è–„çš®åŒ…è£¹å¤§é‡æ¤ç‰©çº–ç¶­ï¼Œåƒ…èƒ½ç¶­æŒåŸºæœ¬é‹ä½œã€‚" },
            205: { name: "æ»·å‘³è±†å¹²", score: 10, desc: "è„«æ°´çš„è±†é¡æ–¹å¡Šï¼Œä¹¾ç‡¥ä¸”ç„¡å‘³ï¼Œä¸å…·é–‹æ¡åƒ¹å€¼ã€‚" },
            206: { name: "çˆ†æ¼¿éª°å­ç‰›", score: 110, desc: "åˆ‡å‰²å·¥æ•´çš„ç«‹æ–¹é«”è‚‰å¡Šï¼Œå…§éƒ¨å°å­˜äº†æ»¾ç‡™æ²¹è„‚ã€‚" },
            207: { name: "ç‡’ä»™è‰", score: 10, desc: "é»‘è‰²å‡è† ç‹€æ¶²é«”ï¼Œå†·å»å¾Œæœƒå›ºåŒ–ï¼Œèƒ½é‡ä¸ç©©å®šã€‚" },
            208: { name: "èƒ¡æ¤’é¤…", score: 60, desc: "è²¼å£é«˜æº«çƒ˜çƒ¤ï¼Œå«æœ‰å°‘é‡è‚‰æœ«èˆ‡è¾›é¦™æ–™ã€‚" },
            301: { name: "é¼æ³°è±å°ç± åŒ…", score: 90, desc: "é»ƒé‡‘æ¯”ä¾‹çš„æ‘ºæ•¸ï¼Œå°å°äº†é«˜æ¿ƒç¸®æ¹¯æ±ç²¾è¯ã€‚" },
            302: { name: "å† è»ç‰›è‚‰éºµ", score: 90, desc: "è¤‡åˆå¼æ¹¯é ­èˆ‡å¤§å¡Šè‚Œç†çµ„ç¹”ï¼Œå®Œç¾çš„èƒ½æºè£œçµ¦ã€‚" },
            303: { name: "çƒ¤é¦™è…¸", score: 20, desc: "äºç¡é…¸é¹½èˆ‡è„‚è‚ªçš„ç®¡ç‹€æ··åˆç‰©ï¼Œåƒ…ä¾›å¨›æ¨‚ã€‚" },
            304: { name: "ä½›è·³ç‰†", score: 90, desc: "å°‡å¤šç¨®é«˜éšç”Ÿç‰©çµ„ç¹”ç‡‰ç…®æ–¼ä¸€ç½ˆï¼Œèƒ½é‡çˆ†è¡¨ã€‚" },
            305: { name: "æª¸æª¬æ„›ç‰", score: 20, desc: "99% éƒ½æ˜¯æ°´åˆ†èˆ‡æ¤ç‰©è† è³ªï¼Œå¹¾ä¹æ²’æœ‰ç†±é‡ã€‚" },
            306: { name: "ç‚¸èŠ‹é¤…", score: 20, desc: "æ²¹ç‚¸çš„æ ¹è–é¡æ¤ç‰©ï¼Œçµæ§‹é¬†æ•£ï¼Œèƒ½é‡ä½è½ã€‚" },
            307: { name: "ç‡Ÿé¤Šä¸‰æ˜æ²»", score: 20, desc: "æ²¹ç‚¸éºµåŒ…å¤¾ç¾ä¹ƒæ»‹ï¼Œç†±é‡é›–é«˜ä½†ç¼ºä¹æ ¸å¿ƒç‰©è³ªã€‚" },
            308: { name: "ç´…èŸ³ç±³ç³•", score: 90, desc: "ç”²æ®¼é¡ç”Ÿç‰©è¦†è“‹æ–¼ç³¯ç±³ä¹‹ä¸Šï¼Œå¯Œå«ç¨€æœ‰è›‹ç™½è³ªã€‚" },
        };

        const GAME_SCRIPT = {
            1: [101, 102, 103, 104, 105, 106, 107, 108],
            2: [201, 202, 203, 204, 205, 206, 207, 208],
            3: [301, 302, 303, 304, 305, 306, 307, 308]
        };

        // --- 2. Firebase åˆå§‹åŒ– ---
        const firebaseConfig = {
            apiKey: "AIzaSyA3Ecj9bNgARAhzrq6_BD4AeiegAku3wak",
            authDomain: "lineweb-24cc1.firebaseapp.com",
            databaseURL: "https://lineweb-24cc1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lineweb-24cc1",
            storageBucket: "lineweb-24cc1.firebasestorage.app",
            messagingSenderId: "97364985402",
            appId: "1:97364985402:web:e3f124780c76f522bd1703"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const ROOM_ID = "room_1";

        // --- 3. å…¨åŸŸè®Šæ•¸ ---
        let myRole = null;
        let myName = "";
        let globalState = { phase: 'waiting', round: 1 };
        let allPlayers = {};
        let roundResult = {};
        let myData = {};

        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        async function init() {
            let roleParam = getQueryParam("role") || "1";
            if (!ROLES[roleParam]) {
                document.getElementById('app-inner').innerHTML = `<div class="p-10 text-center text-white">ç„¡æ•ˆçš„é€£çµåƒæ•¸ (Role Error)</div>`;
                return;
            }

            myRole = parseInt(roleParam);
            myName = ROLES[myRole];
            console.log(`[Identity] ${myName} (Role ${myRole})`);

            // ç«‹å³é¡¯ç¤ºç­‰å¾…ç•«é¢ï¼Œé¿å…é»‘å±
            if (myRole !== 9) {
                showView('waiting-view');
                document.getElementById('waiting-name').innerText = myName;
            } else {
                showView('admin-view');
            }

            // ç›£è½ç‹€æ…‹
            onValue(ref(db, `${ROOM_ID}/game_state`), (snapshot) => {
                const val = snapshot.val();
                if (val) {
                    globalState = val;
                    handleGameStateChange();
                } else if (myRole === 9) {
                    renderAdminPanel(); // ç®¡ç†å“¡çœ‹åˆ°åˆå§‹åŒ–æŒ‰éˆ•
                }
            });

            // ç›£è½ç©å®¶
            onValue(ref(db, `${ROOM_ID}/players`), (snapshot) => {
                allPlayers = snapshot.val() || {};
                if (myRole !== 9) {
                    myData = allPlayers[myRole] || {};
                    if (globalState.phase === 'action') renderRealtimeStats();
                    renderActionView(); // éš¨æ™‚æ›´æ–°è‡ªå·±çš„æ„›å¿ƒç­‰è³‡è¨Š
                } else {
                    renderAdminPanel();
                }
            });

            // ç›£è½çµæœ
            onValue(ref(db, `${ROOM_ID}/round_result`), (snapshot) => {
                roundResult = snapshot.val() || {};
                if (globalState.phase === 'result') renderResultView();
            });

            // ç©å®¶è‡ªæˆ‘è¨»å†Š
            if (myRole !== 9) {
                const myRef = ref(db, `${ROOM_ID}/players/${myRole}`);
                const snap = await get(myRef);
                if (!snap.exists()) {
                    await update(myRef, {
                        name: myName, lives: 2, is_dead: false,
                        food_target: "A", group_target: "A", current_energy: 0
                    });
                }
            }
        }

        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById(viewId);
            if (target) target.classList.remove('hidden');
        }

        function handleGameStateChange() {
            const { phase, round } = globalState;
            console.log(`[Phase Change] ${phase} - Day ${round}`);
            
            if (myRole === 9) {
                showView('admin-view');
                renderAdminPanel();
            } else {
                if (phase === 'waiting') showView('waiting-view');
                else if (phase === 'draw') {
                    showView('draw-view');
                    renderDrawCard(round);
                }
                else if (phase === 'action') {
                    if (!document.getElementById('action-view').dataset.inited) initActionView();
                    showView('action-view');
                    renderActionView();
                }
                else if (phase === 'result') showView('result-view');
                else if (phase === 'end') showView('end-view');
            }
        }

        function renderDrawCard(round) {
            const cardId = GAME_SCRIPT[round][myRole - 1];
            const card = FOOD_DATA[cardId];
            update(ref(db, `${ROOM_ID}/players/${myRole}`), {
                current_energy: card.score,
                current_card_name: card.name
            });
            document.getElementById('draw-card-container').innerHTML = `
                <div class="animate-bounce mb-4 text-6xl">ğŸ</div>
                <div class="bg-gray-800 p-6 rounded-lg border-2 border-purple-500 shadow-xl">
                    <h2 class="text-2xl font-bold text-yellow-400 mb-2">${card.name}</h2>
                    <div class="text-purple-300 text-sm mb-4">${card.desc}</div>
                    <div class="text-4xl font-black text-white">èƒ½é‡ ${card.score}</div>
                </div>
            `;
            document.getElementById('btn-to-action').innerText = "é–‹å§‹æŠ‰æ“‡";
            document.getElementById('btn-to-action').disabled = false;
        }

        window.enterActionPhase = function() {
            document.getElementById('btn-to-action').innerText = "ç­‰å¾…å‚³è¼¸æŒ‡ä»¤...";
            document.getElementById('btn-to-action').disabled = true;
        }

        function initActionView() {
            const randFood = Math.random() < 0.5 ? "A" : "B";
            const randGroup = Math.random() < 0.5 ? "A" : "B";
            update(ref(db, `${ROOM_ID}/players/${myRole}`), { food_target: randFood, group_target: randGroup });
            document.getElementById('action-view').dataset.inited = "true";
        }

        function renderActionView() {
            if (myRole === 9 || !myData.name) return;
            const round = globalState.round || 1;
            const cardId = GAME_SCRIPT[round][myRole - 1];
            const card = FOOD_DATA[cardId];
            document.getElementById('round-num').innerText = round;
            document.getElementById('my-status').innerHTML = `
                <div class="flex justify-between items-center">
                    <span class="text-yellow-400 font-bold">${card.name} (${card.score})</span>
                    <span class="text-red-500 flex items-center gap-1">${renderHearts(myData.lives)}</span>
                </div>
            `;
            if (myData.is_dead) document.getElementById('ghost-alert').classList.remove('hidden');
            else document.getElementById('ghost-alert').classList.add('hidden');
            updateToggleButton('food', myData.food_target);
            updateToggleButton('group', myData.group_target);
        }

        function renderHearts(count) {
            let h = '';
            for(let i=0; i<2; i++) h += `<i class="fa-${i < count ? 'solid' : 'regular'} fa-heart ${i >= count ? 'opacity-30' : ''}"></i>`;
            return h;
        }

        function renderRealtimeStats() {
            let ea = 0, eb = 0;
            Object.values(allPlayers).forEach(p => {
                const s = p.is_dead ? 0 : (p.current_energy || 0);
                if (p.food_target === "A") ea += s; else eb += s;
            });
            document.getElementById('stat-energy-a').innerText = ea;
            document.getElementById('stat-energy-b').innerText = eb;
        }

        window.toggleChoice = function(type, val) {
            if (globalState.is_locked) return;
            const obj = {}; obj[type === 'food' ? 'food_target' : 'group_target'] = val;
            update(ref(db, `${ROOM_ID}/players/${myRole}`), obj);
            if (navigator.vibrate) navigator.vibrate(30);
        }

        function updateToggleButton(type, val) {
            const a = document.getElementById(`btn-${type}-a`), b = document.getElementById(`btn-${type}-b`);
            if (!a || !b) return;
            const cls = type === 'food' ? 'ring-4 ring-yellow-400 scale-105' : 'ring-4 ring-green-400 scale-105';
            [a, b].forEach(btn => btn.classList.remove('ring-4', 'ring-yellow-400', 'ring-green-400', 'scale-105', 'opacity-50'));
            if (val === 'A') { a.classList.add(...cls.split(' ')); b.classList.add('opacity-50'); }
            else { b.classList.add(...cls.split(' ')); a.classList.add('opacity-50'); }
        }

        function renderResultView() {
            if (!roundResult.avg_A) return;
            const myAvg = myData.group_target === 'A' ? roundResult.avg_A : roundResult.avg_B;
            const isSafe = myAvg >= 60;
            document.getElementById('result-content').innerHTML = `
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-purple-900/40 p-3 rounded border border-purple-500">
                        <div class="text-xs text-purple-300">å¤–æ˜Ÿäººèƒ½é‡</div>
                        <div class="text-3xl font-mono">${roundResult.energy_A}</div>
                    </div>
                    <div class="bg-blue-900/40 p-3 rounded border border-blue-500">
                        <div class="text-xs text-blue-300">åœ°çƒäººèƒ½é‡</div>
                        <div class="text-3xl font-mono">${roundResult.energy_B}</div>
                    </div>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg mb-4 flex justify-around">
                    <div class="${roundResult.avg_A >= 60 ? 'text-green-400' : 'text-red-400'}">å¤–æ˜Ÿå‡åˆ†: ${Math.floor(roundResult.avg_A)}</div>
                    <div class="${roundResult.avg_B >= 60 ? 'text-green-400' : 'text-red-400'}">åœ°çƒå‡åˆ†: ${Math.floor(roundResult.avg_B)}</div>
                </div>
                <div class="text-center py-8 border-2 ${isSafe ? 'border-green-500 bg-green-900/20' : 'border-red-500 bg-red-900/20'} rounded-xl">
                     <i class="fa-solid ${isSafe ? 'fa-check-circle text-green-400' : 'fa-skull text-red-500'} text-6xl mb-4"></i>
                     <h2 class="text-3xl font-bold">${isSafe ? 'å­˜æ´»' : 'å—å‚·'}</h2>
                </div>
            `;
        }

        function renderAdminPanel() {
            const ctrl = document.getElementById('admin-controls');
            if (!globalState.phase) {
                ctrl.innerHTML = `<button onclick="resetGame()" class="w-full bg-red-600 py-4 rounded font-bold">åˆå§‹åŒ–è³‡æ–™åº«</button>`;
                return;
            }
            document.getElementById('admin-status').innerHTML = `Round: ${globalState.round} | Phase: ${globalState.phase}`;
            let btns = '';
            const p = globalState.phase;
            if (p === 'waiting') btns = `<button onclick="adminSetPhase('draw')" class="w-full bg-blue-600 py-4 rounded">ç™¼é€é£Ÿç‰© (é–‹å§‹)</button>`;
            else if (p === 'draw') btns = `<button onclick="adminSetPhase('action')" class="w-full bg-green-600 py-4 rounded">é–‹å§‹æŠ‰æ“‡</button>`;
            else if (p === 'action') btns = `<button onclick="adminCalculate()" class="w-full bg-red-600 py-4 rounded">é–å®šä¸¦çµç®—</button>`;
            else if (p === 'result') btns = `<button onclick="${globalState.round < 3 ? 'adminNextRound()' : "adminSetPhase('end')"}" class="w-full bg-yellow-600 py-4 rounded">${globalState.round < 3 ? 'é€²å…¥ä¸‹ä¸€å¤©' : 'çµæŸéŠæˆ²'}</button>`;
            else btns = `<button onclick="resetGame()" class="w-full border border-red-500 py-2 rounded">é‡ç½®éŠæˆ²</button>`;
            ctrl.innerHTML = btns;

            let playersHtml = `<div class="mt-4 space-y-1">`;
            Object.keys(ROLES).forEach(id => {
                if (id == 9) return;
                const player = allPlayers[id] || { name: ROLES[id], lives: 2, is_dead: false };
                playersHtml += `<div class="flex justify-between text-xs p-1 border-b border-gray-700 ${player.is_dead ? 'text-gray-600' : ''}">
                    <span>${player.name} (${player.lives}â¤)</span>
                    <span>${player.food_target || '-'}/${player.group_target || '-'}</span>
                </div>`;
            });
            document.getElementById('admin-players').innerHTML = playersHtml + `</div>`;
        }

        window.adminSetPhase = (p) => update(ref(db, `${ROOM_ID}/game_state`), { phase: p, is_locked: false });
        window.adminCalculate = async () => {
            await update(ref(db, `${ROOM_ID}/game_state`), { is_locked: true });
            const snap = await get(ref(db, `${ROOM_ID}/players`));
            const players = snap.val();
            let sa = 0, pa = 0, sb = 0, pb = 0, injured = [];
            Object.entries(players).forEach(([id, p]) => {
                const score = p.is_dead ? 0 : (p.current_energy || 0);
                if (p.food_target === 'A') sa += score; else sb += score;
                if (!p.is_dead) {
                    if (p.group_target === 'A') pa++; else pb++;
                }
            });
            const aa = pa > 0 ? sa/pa : 0, ab = pb > 0 ? sb/pb : 0;
            let up = {};
            Object.entries(players).forEach(([id, p]) => {
                if (p.is_dead) return;
                const avg = p.group_target === 'A' ? aa : ab;
                if (avg < 60) {
                    const l = p.lives - 1;
                    up[`${ROOM_ID}/players/${id}/lives`] = l;
                    if (l <= 0) up[`${ROOM_ID}/players/${id}/is_dead`] = true;
                }
            });
            up[`${ROOM_ID}/round_result`] = { energy_A: sa, energy_B: sb, avg_A: aa, avg_B: ab };
            up[`${ROOM_ID}/game_state/phase`] = 'result';
            await update(ref(db), up);
        };
        window.adminNextRound = () => {
            update(ref(db, `${ROOM_ID}/game_state`), { round: globalState.round + 1, phase: 'draw', is_locked: false });
            set(ref(db, `${ROOM_ID}/round_result`), {});
        };
        window.resetGame = async () => {
            await set(ref(db, ROOM_ID), { game_state: { phase: 'waiting', round: 1, is_locked: false }, players: {}, round_result: {} });
            window.location.reload();
        };

        init();
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #020617; color: white; margin: 0; overflow: hidden; }
        .view-section { height: 100%; display: flex; flex-direction: column; }
    </style>
</head>
<body class="bg-slate-950 flex items-center justify-center min-h-screen">

    <div id="app" class="w-full max-w-md h-[90vh] bg-slate-900/80 backdrop-blur-lg border border-slate-700 shadow-2xl relative overflow-hidden rounded-3xl">
        <div id="app-inner" class="p-6 h-full">
            
            <!-- === ç­‰å¾…ç•«é¢ === -->
            <div id="waiting-view" class="view-section hidden justify-center items-center text-center">
                <div class="animate-pulse mb-8">
                    <i class="fa-solid fa-user-astronaut text-7xl text-blue-500"></i>
                </div>
                <h1 class="text-xl text-slate-400">æ­¡è¿å›ä¾†ï¼ŒæŒ‡æ®å®˜</h1>
                <h2 id="waiting-name" class="text-4xl font-black text-white mt-2 mb-8">...</h2>
                <div class="flex items-center gap-2 text-blue-400 bg-blue-900/30 px-4 py-2 rounded-full border border-blue-500/30">
                    <i class="fa-solid fa-circle-notch animate-spin"></i>
                    <span>ç­‰å¾…æ¯è‰¦æŒ‡ä»¤...</span>
                </div>
            </div>

            <!-- === æŠ½å¡ç•«é¢ === -->
            <div id="draw-view" class="view-section hidden">
                <h1 class="text-center text-slate-500 font-bold mb-8">ç‰©è³‡æƒæä¸­</h1>
                <div id="draw-card-container" class="flex-1 flex flex-col justify-center items-center text-center"></div>
                <button id="btn-to-action" onclick="enterActionPhase()" class="w-full py-4 bg-blue-600 rounded-2xl font-bold shadow-lg mt-8 hover:bg-blue-500 transition-colors">ç¢ºèªæ”¶åˆ°</button>
            </div>

            <!-- === æŠ‰æ“‡ç•«é¢ === -->
            <div id="action-view" class="view-section hidden">
                <div class="flex justify-between items-center mb-6">
                    <div class="text-slate-400 font-bold">ç¬¬ <span id="round-num">1</span> å¤©</div>
                    <div id="ghost-alert" class="hidden text-xs text-orange-400 bg-orange-900/20 px-2 py-1 rounded">å¹½éˆæ¨¡å¼</div>
                </div>
                <div id="my-status" class="bg-slate-800 p-4 rounded-2xl mb-6"></div>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-purple-900/20 p-4 rounded-2xl border border-purple-500/30 text-center">
                        <div class="text-xs text-purple-400 mb-1">å¤–æ˜Ÿäººèƒ½é‡</div>
                        <div id="stat-energy-a" class="text-3xl font-mono font-bold">0</div>
                    </div>
                    <div class="bg-blue-900/20 p-4 rounded-2xl border border-blue-500/30 text-center">
                        <div class="text-xs text-blue-400 mb-1">åœ°çƒäººèƒ½é‡</div>
                        <div id="stat-energy-b" class="text-3xl font-mono font-bold">0</div>
                    </div>
                </div>
                <div class="space-y-6 flex-1">
                    <div>
                        <label class="text-xs text-slate-500 mb-2 block uppercase tracking-widest">èƒ½é‡å‚³è¼¸ç›®æ¨™</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="btn-food-a" onclick="toggleChoice('food', 'A')" class="py-3 rounded-xl bg-slate-800 border border-slate-700 font-bold">å¤–æ˜Ÿäºº</button>
                            <button id="btn-food-b" onclick="toggleChoice('food', 'B')" class="py-3 rounded-xl bg-slate-800 border border-slate-700 font-bold">åœ°çƒäºº</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-slate-500 mb-2 block uppercase tracking-widest">æœ¬äººåŠ å…¥é™£ç‡Ÿ</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="btn-group-a" onclick="toggleChoice('group', 'A')" class="py-6 rounded-2xl bg-slate-800 border border-slate-700 font-bold flex flex-col items-center gap-1"><i class="fa-solid fa-rocket"></i>å¤–æ˜Ÿäºº</button>
                            <button id="btn-group-b" onclick="toggleChoice('group', 'B')" class="py-6 rounded-2xl bg-slate-800 border border-slate-700 font-bold flex flex-col items-center gap-1"><i class="fa-solid fa-house"></i>åœ°çƒäºº</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- === çµæœç•«é¢ === -->
            <div id="result-view" class="view-section hidden">
                <h1 class="text-center text-2xl font-black mb-8">çµç®—å ±å‘Š</h1>
                <div id="result-content" class="flex-1"></div>
            </div>

            <!-- === çµæŸç•«é¢ === -->
            <div id="end-view" class="view-section hidden justify-center items-center text-center">
                <h1 class="text-5xl font-black mb-4">å®Œçµ</h1>
                <p class="text-slate-400">æ„Ÿè¬åƒèˆ‡æ˜Ÿéš›é‡é›£ç”Ÿå­˜æˆ°</p>
            </div>

            <!-- === ç®¡ç†å“¡ç•«é¢ === -->
            <div id="admin-view" class="view-section hidden">
                <h1 class="text-red-500 font-bold mb-4">ç®¡ç†å“¡æ§åˆ¶å°</h1>
                <div id="admin-status" class="text-xs font-mono mb-4 bg-black p-2 rounded"></div>
                <div id="admin-controls" class="space-y-2"></div>
                <div id="admin-players" class="flex-1 overflow-y-auto mt-4"></div>
            </div>

        </div>
    </div>

</body>
</html>
