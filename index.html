<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ˜Ÿéš›é‡é›£è€…ï¼šæ·±ç©ºç”Ÿå­˜æˆ°</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: '#020617',      // æ¥µæ·±è—èƒŒæ™¯
                        panel: '#1e293b',   // é¢æ¿åº•è‰²
                        alien: '#d946ef',   // å¤–æ˜Ÿç´« (é«˜äº®)
                        earth: '#3b82f6',   // åœ°çƒè— (é«˜äº®)
                        inactive: '#334155' // æœªé¸ä¸­ç°
                    }
                }
            }
        }
    </script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700;900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, update, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- 1. éŠæˆ²è³‡æ–™ ---
        const ROLES = {
            1: "æ¼¢å¾·æ£®", 2: "è³ˆæ–¯å¹½", 3: "æ ¼æ‹‰å…‹", 4: "æˆˆå¾·å‡",
            5: "æ€ç‘ªç‰¹", 6: "å‰å°¼äº", 7: "è‰¾è‰æ ¹", 8: "æ‹‰å¼—ç±³",
            9: "ç®¡ç†å“¡"
        };

        const FOOD_DATA = {
            101: { name: "è±ªå¤§å¤§é›æ’", score: 80 }, 102: { name: "å¤§è…¸åŒ…å°è…¸", score: 50 },
            103: { name: "çç å¥¶èŒ¶", score: 80 },   104: { name: "èšµä»”ç…", score: 50 },
            105: { name: "èŠ’æœé›ªèŠ±å†°", score: 80 }, 106: { name: "æ·±å‘è‡­è±†è…", score: 50 },
            107: { name: "è—¥ç‡‰æ’éª¨", score: 80 },   108: { name: "åœ°ç“œçƒ", score: 50 },
            201: { name: "ç³–è‘«è˜†", score: 10 },     202: { name: "ç«ç„°ç‰›æ’", score: 110 },
            203: { name: "è±¬è¡€ç³•", score: 10 },     204: { name: "æ½¤é¤…æ²", score: 60 },
            205: { name: "æ»·å‘³è±†å¹²", score: 10 },   206: { name: "éª°å­ç‰›", score: 110 },
            207: { name: "ç‡’ä»™è‰", score: 10 },     208: { name: "èƒ¡æ¤’é¤…", score: 60 },
            301: { name: "å°ç± åŒ…", score: 90 },     302: { name: "ç‰›è‚‰éºµ", score: 90 },
            303: { name: "çƒ¤é¦™è…¸", score: 20 },     304: { name: "ä½›è·³ç‰†", score: 90 },
            305: { name: "æª¸æª¬æ„›ç‰", score: 20 },   306: { name: "ç‚¸èŠ‹é¤…", score: 20 },
            307: { name: "ç‡Ÿé¤Šä¸‰æ˜æ²»", score: 20 }, 308: { name: "ç´…èŸ³ç±³ç³•", score: 90 },
        };

        const GAME_SCRIPT = {
            1: [101, 102, 103, 104, 105, 106, 107, 108],
            2: [201, 202, 203, 204, 205, 206, 207, 208],
            3: [301, 302, 303, 304, 305, 306, 307, 308]
        };

        const firebaseConfig = {
            apiKey: "AIzaSyA3Ecj9bNgARAhzrq6_BD4AeiegAku3wak",
            authDomain: "lineweb-24cc1.firebaseapp.com",
            databaseURL: "https://lineweb-24cc1-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "lineweb-24cc1",
            storageBucket: "lineweb-24cc1.firebasestorage.app",
            messagingSenderId: "97364985402",
            appId: "1:97364985402:web:e3f124780c76f522bd1703"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const ROOM_ID = "room_1";

        let myRole = null;
        let myName = "";
        let globalState = { phase: 'waiting', round: 1 };
        let allPlayers = {};
        let roundResult = {};
        let myData = {};

        function getParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            let val = urlParams.get(name);
            
            // å¦‚æœç›´æ¥åƒæ•¸æŠ“ä¸åˆ°ï¼Œå˜—è©¦å¾ liff.state æŠ“å–
            if (!val) {
                const liffState = urlParams.get('liff.state');
                if (liffState) {
                    // liff.state é€šå¸¸æ˜¯è¢« URL ç·¨ç¢¼éçš„ (ä¾‹å¦‚ %3Frole%3D2)
                    // è§£ç¢¼å¾Œè®Šæˆ ?role=2
                    try {
                        const decodedState = decodeURIComponent(liffState);
                        // å»æ‰å¯èƒ½å­˜åœ¨çš„é–‹é ­ ? (URLSearchParams æœ‰æ™‚æœƒè™•ç†ï¼Œä½†ä¿éšªèµ·è¦‹)
                        const cleanState = decodedState.startsWith('?') ? decodedState.substring(1) : decodedState;
                        const stateParams = new URLSearchParams(cleanState);
                        val = stateParams.get(name);
                        console.log(`Parsed ${name} from liff.state: ${val}`);
                    } catch (e) {
                        console.error("Error parsing liff.state", e);
                    }
                }
            }
            return val;
        }


        async function init() {
            let roleParam = getParam("role") || "1";
            myRole = parseInt(roleParam);
            myName = ROLES[myRole];

            // 1. æ¸²æŸ“åŸºç¤ç•«é¢
            if (myRole !== 9) {
                switchView('waiting-view');
                document.getElementById('waiting-name').innerText = myName;
            } else {
                switchView('admin-view');
            }

            // 2. ç›£è½ Firebase (å¢åŠ éŒ¯èª¤è™•ç†)
            console.log("Connecting to Firebase...");
            
            // ç›£è½ç‹€æ…‹
            onValue(ref(db, `${ROOM_ID}/game_state`), (snap) => {
                const val = snap.val();
                if (val) {
                    globalState = val;
                    handleGameStateChange();
                } else {
                    console.log("No game state found.");
                    if (myRole === 9) renderAdmin(); // è‹¥ç„¡ç‹€æ…‹ï¼Œè®“ Admin åˆå§‹åŒ–
                }
            }, (error) => {
                console.error("Firebase Read Error (State):", error);
                alert("è®€å–è³‡æ–™å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–æ¬Šé™");
            });

            // ç›£è½ç©å®¶
            onValue(ref(db, `${ROOM_ID}/players`), (snap) => {
                allPlayers = snap.val() || {};
                
                if (myRole !== 9) {
                    myData = allPlayers[myRole] || {};
                    // å¦‚æœæ‹¿åˆ°è³‡æ–™äº†ï¼Œå˜—è©¦æ›´æ–° UI
                    if (globalState.phase === 'action') {
                        renderActionView();
                    }
                } else {
                    renderAdmin();
                }
            }, (error) => {
                console.error("Firebase Read Error (Players):", error);
            });

            // ç›£è½çµç®—
            onValue(ref(db, `${ROOM_ID}/round_result`), (snap) => {
                roundResult = snap.val() || {};
                if (globalState.phase === 'result') renderResult();
            });

            // 3. å¼·åˆ¶å¯«å…¥ç©å®¶åˆå§‹è³‡æ–™ (ä¿®å¾©è³‡æ–™ä¸å­˜åœ¨çš„å•é¡Œ)
            if (myRole !== 9) {
                const myRef = ref(db, `${ROOM_ID}/players/${myRole}`);
                // å…ˆè®€ä¸€æ¬¡ï¼Œå¦‚æœæ²’æœ‰å°±å¯«å…¥
                get(myRef).then((snap) => {
                    if (!snap.exists()) {
                        console.log("Initializing Player Data...");
                        update(myRef, {
                            name: myName, lives: 2, is_dead: false,
                            food_target: "A", group_target: "A", current_energy: 0
                        });
                    }
                }).catch(err => console.error("Init Player Failed:", err));
            }
        }

        function switchView(id) {
            document.querySelectorAll('.page-view').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function handleGameStateChange() {
            const { phase, round } = globalState;
            
            if (myRole === 9) {
                switchView('admin-view');
                renderAdmin();
                return;
            }

            if (phase === 'waiting') {
                switchView('waiting-view');
                document.getElementById('waiting-name').innerText = myName;
                document.getElementById('waiting-status').innerText = "ç­‰å¾…æŒ‡ä»¤...";
            }
            else if (phase === 'draw') {
                switchView('draw-view');
                resetDrawUI(round);
            }
            else if (phase === 'action') {
                switchView('action-view');
                renderActionView();
            }
            else if (phase === 'result') {
                switchView('result-view');
            }
            else if (phase === 'end') {
                switchView('end-view');
            }
        }

        // --- æŠ½å¡æµç¨‹ ---
        function resetDrawUI(round) {
            // é‡ç½®ç‚º Step 1
            document.getElementById('draw-step-1').classList.remove('hidden');
            document.getElementById('draw-step-2').classList.add('hidden');
            
            // é¡¯ç¤ºç”Ÿå‘½
            const lives = myData.lives || 2;
            document.getElementById('draw-lives').innerText = `ç”Ÿå‘½ ${'â¤ï¸'.repeat(lives)}`;

            // æº–å‚™å¡ç‰‡è³‡æ–™
            const cardId = GAME_SCRIPT[round][myRole - 1];
            const card = FOOD_DATA[cardId];
            if(card) {
                document.getElementById('card-name').innerText = card.name;
                document.getElementById('card-score').innerText = `èƒ½é‡: ${card.score}`;
            }
        }

        window.revealCard = () => {
            document.getElementById('draw-step-1').classList.add('hidden');
            document.getElementById('draw-step-2').classList.remove('hidden');
        }

        window.confirmDraw = () => {
            // æŒ‰ä¸‹æ”¶ä¸‹ï¼Œé¡¯ç¤ºç­‰å¾…
            const btn = document.getElementById('btn-confirm-draw');
            btn.innerText = "ç­‰å¾…é€²å…¥æŠ‰æ“‡éšæ®µ...";
            btn.className = "w-full py-6 bg-gray-600 text-gray-300 rounded-2xl text-2xl font-bold cursor-not-allowed";
            btn.disabled = true;
        }

        // --- æŠ‰æ“‡æµç¨‹ (æ ¸å¿ƒä¿®æ”¹) ---
        function renderActionView() {
            // é˜²å‘†
            if (!myData) myData = { name: myName, lives: 2, food_target: 'A', group_target: 'A' };

            const round = globalState.round;
            const cardId = GAME_SCRIPT[round][myRole - 1];
            const card = FOOD_DATA[cardId];

            // 1. è³‡è¨Šåˆ—
            document.getElementById('info-day').innerText = `Day ${round}`;
            document.getElementById('info-lives').innerText = `ç”Ÿå‘½ ${'â¤ï¸'.repeat(myData.lives || 2)}`;

            // 2. é£Ÿç‰©è³‡è¨Š
            if (card) {
                document.getElementById('act-food-name').innerText = card.name;
                document.getElementById('act-food-score').innerText = `èƒ½é‡ ${card.score}`;
            }

            // 3. å¹½éˆæç¤º
            const ghost = document.getElementById('ghost-msg');
            if (myData.is_dead) ghost.classList.remove('hidden');
            else ghost.classList.add('hidden');

            // 4. å³æ™‚æˆ°æ³
            let ea = 0, eb = 0;
            Object.values(allPlayers).forEach(p => {
                const s = p.is_dead ? 0 : (p.current_energy || 0);
                if (p.food_target === "A") ea += s; else eb += s;
            });
            document.getElementById('stat-a').innerText = ea;
            document.getElementById('stat-b').innerText = eb;

            // 5. æ›´æ–°ä¸‰æ¬„å¼æŒ‰éˆ• (å·¦æŒ‰éˆ• | ä¸­é–“é¡¯ç¤º | å³æŒ‰éˆ•)
            updateTriSelector('food', myData.food_target);
            updateTriSelector('group', myData.group_target);
        }

        window.toggleChoice = (type, val) => {
            if (globalState.is_locked) return;
            const obj = {};
            obj[type === 'food' ? 'food_target' : 'group_target'] = val;
            update(ref(db, `${ROOM_ID}/players/${myRole}`), obj);
        }

        // æ–°ç‰ˆä¸‰æ¬„å¼é¸æ“‡å™¨é‚è¼¯
        function updateTriSelector(type, val) {
            const displayBox = document.getElementById(`${type}-display-box`);
            const displayText = document.getElementById(`${type}-display-text`);
            
            if (!displayBox || !displayText) return;

            if (val === 'A') {
                // å¤–æ˜Ÿäººæ¨£å¼
                displayBox.className = "flex-1 mx-2 rounded-2xl border-4 border-alien bg-alien/20 flex flex-col items-center justify-center transition-all duration-300 shadow-[0_0_15px_#a855f7]";
                displayText.className = "text-2xl font-black text-alien";
                displayText.innerHTML = '<i class="fa-brands fa-reddit-alien mb-1"></i> å¤–æ˜Ÿäºº';
            } else {
                // åœ°çƒäººæ¨£å¼
                displayBox.className = "flex-1 mx-2 rounded-2xl border-4 border-earth bg-earth/20 flex flex-col items-center justify-center transition-all duration-300 shadow-[0_0_15px_#3b82f6]";
                displayText.className = "text-2xl font-black text-earth";
                displayText.innerHTML = '<i class="fa-solid fa-earth-americas mb-1"></i> åœ°çƒäºº';
            }
        }

        // --- çµç®— ---
        function renderResult() {
            if (!roundResult.energy_A) return;
            const myAvg = myData.group_target === 'A' ? roundResult.avg_A : roundResult.avg_B;
            const isSafe = myAvg >= 60;

            document.getElementById('res-eng-a').innerText = roundResult.energy_A;
            document.getElementById('res-eng-b').innerText = roundResult.energy_B;
            
            // é¡¯ç¤ºæ•´æ•¸å¹³å‡
            document.getElementById('res-avg-a').innerText = `å‡ ${Math.floor(roundResult.avg_A)}`;
            document.getElementById('res-avg-b').innerText = `å‡ ${Math.floor(roundResult.avg_B)}`;

            const title = document.getElementById('res-title');
            if (isSafe) {
                title.innerText = "å€–å­˜";
                title.className = "text-6xl font-black text-green-400";
            } else {
                title.innerText = "å—å‚·";
                title.className = "text-6xl font-black text-red-500";
            }
        }

        // --- ç®¡ç†å“¡ ---
        function renderAdmin() {
            const btns = document.getElementById('adm-btns');
            const players = document.getElementById('adm-players');
            const summary = document.getElementById('adm-summary');

            document.getElementById('adm-status').innerText = `Round: ${globalState.round} | Phase: ${globalState.phase}`;

            if (!globalState.phase) {
                btns.innerHTML = `<button onclick="resetGame()" class="w-full bg-red-600 py-6 text-2xl font-bold text-white rounded-xl">åˆå§‹åŒ–è³‡æ–™åº«</button>`;
                return;
            }

            // å³æ™‚çµ±è¨ˆ
            let stats = { ae:0, be:0, ap:0, bp:0 };
            let html = "";
            Object.keys(ROLES).forEach(id => {
                if (id == 9) return;
                const p = allPlayers[id] || { name: ROLES[id], lives:2, is_dead:false };
                if (!p.is_dead) {
                    if(p.food_target === 'A') stats.ae += (p.current_energy||0); else stats.be += (p.current_energy||0);
                    if(p.group_target === 'A') stats.ap++; else stats.bp++;
                }
                html += `<div class="flex justify-between p-3 mb-2 bg-panel rounded border border-gray-700 items-center">
                    <span class="text-white text-lg font-bold">${p.name} <span class="text-gray-400 text-sm">(${p.lives}â¤)</span></span>
                    <div class="flex gap-2">
                        <span class="px-3 py-1 rounded font-bold ${p.food_target==='A'?'bg-alien text-white':'bg-earth text-white'}">é£Ÿ</span>
                        <span class="px-3 py-1 rounded font-bold ${p.group_target==='A'?'bg-alien text-white':'bg-earth text-white'}">äºº</span>
                    </div>
                </div>`;
            });
            players.innerHTML = html;
            summary.innerHTML = `
                <div class="grid grid-cols-2 gap-4 mb-4 text-center">
                    <div class="bg-alien p-3 rounded-xl text-white font-bold text-xl">å¤–: ${stats.ae} / ${stats.ap}äºº</div>
                    <div class="bg-earth p-3 rounded-xl text-white font-bold text-xl">åœ°: ${stats.be} / ${stats.bp}äºº</div>
                </div>
            `;

            // æŒ‰éˆ•é‚è¼¯
            let b = "";
            const p = globalState.phase;
            if (p === 'waiting') b = `<button onclick="admStartDraw(1)" class="w-full bg-alien py-6 text-2xl font-black text-white rounded-xl shadow-lg border-b-4 border-purple-900">ğŸ“¡ é–‹å•ŸæŠ½å¡ (Day 1)</button>`;
            else if (p === 'draw') b = `<button onclick="admSetPhase('action')" class="w-full bg-green-600 py-6 text-2xl font-black text-white rounded-xl shadow-lg border-b-4 border-green-800">ğŸƒ é€²å…¥æŠ‰æ“‡éšæ®µ</button>`;
            else if (p === 'action') b = `<button onclick="admCalc()" class="w-full bg-red-600 py-6 text-2xl font-black text-white rounded-xl shadow-lg border-b-4 border-red-800">ğŸ”’ é–å®šä¸¦çµç®—</button>`;
            else if (p === 'result') b = `<button onclick="${globalState.round < 3 ? `admStartDraw(${globalState.round+1})` : "admSetPhase('end')"}" class="w-full bg-yellow-600 py-6 text-2xl font-black text-white rounded-xl shadow-lg border-b-4 border-yellow-800">${globalState.round < 3 ? 'ğŸŒ… é–‹å•Ÿä¸‹ä¸€å¤©æŠ½å¡' : 'ğŸ çµæŸéŠæˆ²'}</button>`;
            
            b += `<button onclick="if(confirm('ç¢ºå®šè¦åˆå§‹åŒ–å—ï¼Ÿ')) resetGame()" class="w-full bg-transparent border-2 border-red-500 text-red-500 py-4 mt-6 rounded-xl font-bold text-xl">âš ï¸ åˆå§‹åŒ–è³‡æ–™åº«</button>`;
            btns.innerHTML = b;
        }

        window.admStartDraw = async (r) => {
            const u = {};
            u[`${ROOM_ID}/game_state`] = { phase: 'draw', round: r, is_locked: false };
            for(let i=1; i<=8; i++) {
                const cid = GAME_SCRIPT[r][i-1];
                const c = FOOD_DATA[cid];
                u[`${ROOM_ID}/players/${i}/current_energy`] = c.score;
                const rnd = Math.random() < 0.5 ? "A" : "B";
                u[`${ROOM_ID}/players/${i}/food_target`] = rnd;
                u[`${ROOM_ID}/players/${i}/group_target`] = rnd;
            }
            u[`${ROOM_ID}/round_result`] = {};
            await update(ref(db), u);
        }

        window.admSetPhase = (p) => update(ref(db, `${ROOM_ID}/game_state`), { phase: p, is_locked: false });

        window.admCalc = async () => {
            await update(ref(db, `${ROOM_ID}/game_state`), { is_locked: true });
            const snap = await get(ref(db, `${ROOM_ID}/players`));
            const ps = snap.val();
            let sa=0, sb=0, pa=0, pb=0;
            Object.values(ps).forEach(p => {
                const s = p.is_dead ? 0 : (p.current_energy || 0);
                if (p.food_target === 'A') sa += s; else sb += s;
                if (!p.is_dead) { if (p.group_target === 'A') pa++; else pb++; }
            });
            const aa = pa>0 ? sa/pa : 0;
            const ab = pb>0 ? sb/pb : 0;
            
            let u = {};
            Object.entries(ps).forEach(([id, p]) => {
                if (p.is_dead) return;
                const avg = p.group_target === 'A' ? aa : ab;
                if (avg < 60) {
                    // FIX: è‹¥ p.lives ä¸å­˜åœ¨ï¼ˆå–®äººæ¸¬è©¦æ™‚ï¼‰ï¼Œé è¨­ç‚º 2
                    const currentLives = (typeof p.lives === 'number') ? p.lives : 2;
                    const l = currentLives - 1;
                    u[`${ROOM_ID}/players/${id}/lives`] = l;
                    if (l <= 0) u[`${ROOM_ID}/players/${id}/is_dead`] = true;
                }
            });
            u[`${ROOM_ID}/round_result`] = { energy_A: sa, energy_B: sb, avg_A: aa, avg_B: ab };
            u[`${ROOM_ID}/game_state/phase`] = 'result';
            await update(ref(db), u);
        }

        window.resetGame = async () => {
            // FIX: é‡ç½®æ™‚ï¼Œé å…ˆå¡«å…¥æ‰€æœ‰ç©å®¶çš„åˆå§‹è³‡æ–™
            const initialPlayers = {};
            for(let i=1; i<=8; i++) {
                initialPlayers[i] = {
                    name: ROLES[i],
                    lives: 2,
                    is_dead: false,
                    food_target: "A",
                    group_target: "A",
                    current_energy: 0
                };
            }
            await set(ref(db, ROOM_ID), { 
                game_state: { phase: 'waiting', round: 1, is_locked: false }, 
                players: initialPlayers, 
                round_result: {} 
            });
            window.location.reload();
        }

        init();
    </script>
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #020617; color: white; margin: 0; }
        .page-view { min-height: 100vh; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; padding: 1rem; }
    </style>
</head>
<body class="bg-bg">

    <!-- 1. ç­‰å¾…ç•«é¢ -->
    <div id="waiting-view" class="page-view hidden justify-center items-center text-center">
        <i class="fa-solid fa-satellite-dish text-8xl text-earth mb-8 animate-pulse"></i>
        <div id="waiting-name" class="text-6xl font-black text-white mb-6">...</div>
        <div id="waiting-status" class="text-3xl text-gray-400 font-bold border-2 border-gray-600 px-8 py-3 rounded-full bg-panel">...</div>
    </div>

    <!-- 2. æŠ½å¡ç•«é¢ -->
    <div id="draw-view" class="page-view hidden justify-center items-center">
        
        <!-- Step 1: æƒææŒ‰éˆ• -->
        <div id="draw-step-1" class="w-full flex flex-col items-center flex-1 justify-center">
            <div id="draw-lives" class="text-3xl font-bold text-gray-300 mb-10 bg-panel px-6 py-2 rounded-full border border-gray-600"></div>
            <h1 class="text-center text-gray-400 font-black mb-16 text-4xl">ç²å–é£Ÿç‰©æˆåŠŸ</h1>
            <i class="fa-solid fa-box-open text-9xl text-alien mb-16"></i>
            <button onclick="revealCard()" class="w-full py-8 bg-earth text-white rounded-3xl text-4xl font-black shadow-lg border-b-8 border-blue-900 active:border-b-0 active:translate-y-2 transition-all">
                éš¨æ©Ÿç²å–é£Ÿç‰©
            </button>
        </div>

        <!-- Step 2: é¡¯ç¤ºçµæœ -->
        <div id="draw-step-2" class="hidden w-full flex flex-col items-center flex-1 justify-center">
            <h1 class="text-center text-gray-300 font-black mb-8 text-4xl">ç²å–å®Œæˆ</h1>
            
            <div class="bg-panel p-8 rounded-3xl w-full text-center mb-8 border-4 border-gray-600 shadow-2xl">
                <div class="text-gray-400 text-xl font-bold mb-4">ç²å¾—ç‰©å“</div>
                <div id="card-name" class="text-6xl font-black text-white mb-6 leading-tight">...</div>
                <div id="card-score" class="text-4xl font-bold text-yellow-400">...</div>
            </div>

            <button id="btn-confirm-draw" onclick="confirmDraw()" class="w-full py-8 bg-alien text-white rounded-3xl text-4xl font-black shadow-lg border-b-8 border-purple-900 active:border-b-0 active:translate-y-2 transition-all">
                ç¢ºèª (æ”¶ä¸‹)
            </button>
        </div>
    </div>

<!-- 3. æŠ‰æ“‡ç•«é¢ (Action) - å·²å£“ç¸®ç‰ˆé¢ä»¥é©æ‡‰æ‰‹æ©Ÿå–®å± -->
    <div id="action-view" class="page-view hidden h-full flex flex-col p-2">
        <!-- é ‚éƒ¨è³‡è¨Šåˆ—ï¼šDay èˆ‡ ç”Ÿå‘½å€¼ (ä½µæˆä¸€è¡Œ) -->
        <div class="flex justify-between items-center bg-panel px-4 py-2 rounded-xl border border-gray-700 mb-2 flex-none">
            <div id="info-day" class="text-xl font-black text-earth">Day 1</div>
            <div id="info-lives" class="text-lg font-bold text-white tracking-tighter">ç”Ÿå‘½ â¤ï¸â¤ï¸</div>
        </div>

        <!-- ç²å–é£Ÿç‰©è³‡è¨Š (é«˜åº¦å¤§å¹…ç¸®å°) -->
        <div class="bg-panel p-2 rounded-xl border-2 border-gray-600 mb-2 text-center shadow-lg flex-none">
            <div class="text-gray-400 text-xs font-bold">ç•¶å‰ç²å–é£Ÿç‰©</div>
            <div class="flex items-center justify-center gap-3">
                <div id="act-food-name" class="text-2xl font-black text-white leading-tight">...</div>
                <div id="act-food-score" class="text-xl font-bold text-yellow-400">...</div>
            </div>
        </div>

        <!-- å¹½éˆç‹€æ…‹èˆ‡è¦å‰‡æç¤º (åˆä½µæˆ–ç¸®å°) -->
        <div id="ghost-msg" class="hidden bg-gray-800 text-gray-400 p-1 rounded-lg text-center mb-1 font-bold text-sm border border-gray-600 flex-none">ğŸ‘» å¹½éˆç‹€æ…‹</div>
        
        <div class="text-center text-[10px] text-red-400 font-bold mb-2 bg-gray-900 p-1 rounded-md flex-none tracking-tighter">
            âš ï¸ é™£ç‡Ÿå¹³å‡èƒ½é‡ < 60 æ‰£ä¸€å‘½
        </div>

        <!-- å³æ™‚èƒ½é‡æˆ°æ³ (é«˜åº¦ç¸®æ¸›) -->
        <div class="grid grid-cols-2 gap-2 mb-2 flex-none">
            <div class="bg-panel p-1.5 rounded-lg border border-alien text-center">
                <div class="text-alien font-bold text-[10px]">å¤–æ˜Ÿç¸½èƒ½</div>
                <div id="stat-a" class="text-2xl font-black text-white">0</div>
            </div>
            <div class="bg-panel p-1.5 rounded-lg border border-earth text-center">
                <div class="text-earth font-bold text-[10px]">åœ°çƒç¸½èƒ½</div>
            </div>
        </div>

        <!-- ä¸‹æ–¹æŒ‰éˆ•å€ (ä¸‰æ¬„å¼é¸æ“‡å™¨) -->
        <div class="flex-1 flex flex-col gap-2 min-h-0 overflow-hidden">
            <!-- è²¢ç»é¸æ“‡ -->
            <div class="flex-1 flex flex-col">
                <label class="block text-gray-400 font-bold mb-1 text-sm text-center">ğŸ“¦ èƒ½é‡è¼¸é€ç›®æ¨™</label>
                <div class="flex items-center h-16">
                    <button onclick="toggleChoice('food', 'A')" class="w-14 h-full rounded-l-xl bg-gray-800 border border-gray-600 text-xl"><i class="fa-solid fa-chevron-left text-gray-500"></i></button>
                    <!-- ä¸­é–“é¡¯ç¤º -->
                    <div id="food-display-box" class="flex-1 h-full flex flex-col items-center justify-center border-y border-gray-600 bg-gray-900/50">
                        <div id="food-display-text" class="text-lg font-bold text-gray-500">...</div>
                    </div>
                    <button onclick="toggleChoice('food', 'B')" class="w-14 h-full rounded-r-xl bg-gray-800 border border-gray-600 text-xl"><i class="fa-solid fa-chevron-right text-gray-500"></i></button>
                </div>
            </div>
            
            <!-- é™£ç‡Ÿé¸æ“‡ -->
            <div class="flex-1 flex flex-col">
                <label class="block text-gray-400 font-bold mb-1 text-sm text-center">ğŸš€ æœ¬äººåŠ å…¥ç‡Ÿåœ°</label>
                <div class="flex items-center h-16">
                    <button onclick="toggleChoice('group', 'A')" class="w-14 h-full rounded-l-xl bg-gray-800 border border-gray-600 text-xl"><i class="fa-solid fa-chevron-left text-gray-500"></i></button>
                    <!-- ä¸­é–“é¡¯ç¤º -->
                    <div id="group-display-box" class="flex-1 h-full flex flex-col items-center justify-center border-y border-gray-600 bg-gray-900/50">
                        <div id="group-display-text" class="text-lg font-bold text-gray-500">...</div>
                    </div>
                    <button onclick="toggleChoice('group', 'B')" class="w-14 h-full rounded-r-xl bg-gray-800 border border-gray-600 text-xl"><i class="fa-solid fa-chevron-right text-gray-500"></i></button>
                </div>
            </div>
        </div>
        <div class="text-center text-[10px] text-gray-600 mt-1 uppercase">Waiting for Command</div>
    </div>

    <!-- 4. çµç®—ç•«é¢ -->
    <div id="result-view" class="page-view hidden justify-center text-center">
        <h1 class="text-5xl font-black text-white mb-10">çµç®—å ±å‘Š</h1>
        
        <div class="grid grid-cols-2 gap-4 mb-10">
            <div class="bg-panel p-6 rounded-3xl border-t-8 border-alien">
                <div class="text-alien font-bold mb-2 text-xl">å¤–æ˜Ÿèƒ½é‡</div>
                <div id="res-eng-a" class="text-5xl font-black text-white">0</div>
                <div id="res-avg-a" class="text-lg text-gray-400 mt-2">å‡ 0</div>
            </div>
            <div class="bg-panel p-6 rounded-3xl border-t-8 border-earth">
                <div class="text-earth font-bold mb-2 text-xl">åœ°çƒèƒ½é‡</div>
                <div id="res-eng-b" class="text-5xl font-black text-white">0</div>
                <div id="res-avg-b" class="text-lg text-gray-400 mt-2">å‡ 0</div>
            </div>
        </div>

        <div class="bg-panel p-10 rounded-[40px] border-4 border-gray-600 shadow-2xl">
            <div id="res-title" class=""></div>
            <div class="text-gray-500 mt-6 text-xl font-bold">è«‹ç­‰å¾…ä¸‹ä¸€å›åˆ...</div>
        </div>
    </div>

    <!-- 5. çµæŸ -->
    <div id="end-view" class="page-view hidden justify-center items-center text-center">
        <h1 class="text-7xl font-black text-white mb-6">å®Œçµ</h1>
        <p class="text-3xl text-gray-400">æ„Ÿè¬éŠç©</p>
    </div>

    <!-- 9. ç®¡ç†å“¡ -->
    <div id="admin-view" class="page-view hidden bg-black overflow-y-auto block">
        <h1 class="text-4xl font-black text-red-500 mb-6 text-center">GM æ§åˆ¶å°</h1>
        <div id="adm-status" class="text-sm font-mono text-gray-500 mb-4 text-center"></div>
        <div id="adm-summary" class="mb-6"></div>
        <div id="adm-btns" class="mb-8 space-y-4"></div>
        <div id="adm-players" class="flex-1 pb-10"></div>
    </div>

</body>
</html>
